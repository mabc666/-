# 网络层知识总结
- 网络层服务
- 数据报网络与虚电路网络
- 网络互连与网络互联设备
- 网络层拥塞控制
- Internet网络层
- 路由算法与路由协议  
---  
### 一、网络层服务  
网络层最主要的就是将传输层的报文段封装一下然后通过多跳中间路由器，把报文从源主机送到目的主机。  
其中最重要的两项功能是：  
- 转发：当接收到一个分组以后，路由器需要决策通过哪条输出链路将分组发送出去，并将分组移送到该输出接口上去。
- 路由选择：当分组从源主机流向目的主机时候，必须通过某种方式决定分组经过的路由和路径，计算分组所经过的路径的算法被称为路由选择算法。  

一般路由器都有一张转发表里面有IP所对应的转发接口。  

### 二、数据报网络和虚电路网络  
1、数据报网络  
按照目的主机地址进行路由选择的网络称为数据报网络。因特网的IP都是按照地址进行路由选择的，因此因特网是一个数据报网络。数据报网络也是一个不可靠的、无连接的网络，每个分组携带源主机地址和目的主机地址，所以就算是相同的源和目的地址的分组也不一定走相同的路径，所以会导致分组到达有先后。其可靠性都是靠上层TCP协议来保证的。  

2、虚电路网络  
虚电路网络在网络层提供面向连接的分组交换服务，通信之前，双方需要先建立虚电路，通信结束后在拆除虚电路。虚电路是在源和目的主机之间建议一条网络层逻辑连接。虚电路在传输分组的时候每条链路都有相应的VCID（虚电路标识），并且传输的时候占用全部带宽。虚电路由于在传输之前就建立了一条逻辑链路所以沿同一条虚电路传输的分组肯定是按序到达的。 

接下来看下虚电路到底是如何根据VCID表来转发分组的  
首先确定路径，根据确定的路径分配VCID号。
每个路由器都维护了一张VCID表，当虚电路建立起来以后，路径是固定的然后根据输入端口的VCID号查VCID表根据表把分组转送到对应的输出链路接口上然后发送出去。    

虚电路还分为两种：一种是永久型虚电路（PVC）是一种提前建立好的、长期使用的虚电路，所以其建立时间的开销基本上可以忽略。还有一种是交换型虚电路（SVC）是根据通信需要而面临建立的虚电路，通信结束后立即拆除，所以开销比较大。    

接下来比较一下虚电路和数据报网络，这两个网络最大的区别就是虚电路网络的话会做一些顺序控制、差错控制和流量控制而使得端系统比较简单，而数据报网络则把这些任务都甩给了端系统而自己的实现比较简单。  

### 三、网络互连与网络互连设备  
1、异构网络互连  
互联网中有许多不同的协议，所以在传输的过程中中间的路由器或者网关等，在协议之间相互转换。这样就可以使得异构网络变成同构网络了，解决了网络间使用不同协议所带来的问题。  

2、路由器  
输入端口：路由器输入端口从物理接口接收信号，还原数据链路层帧，提取IP数据报，根据IP数据报中的目的地址检索路由表，然后根据路由表将其转发到对应的输出端口上。  
交换结构：当上面确定了应该转发到哪个输出接口后，转发这件事情就由交换结构来完成了，通常的交换结构有3种分别是基于内存的交换结构、基于总线的交换结构、基于网络的交换结构。  
输出端口：当经过交换结构将分组送到输出端口以后，输出端口首先提供一个缓存排队的功能，然后从队列种取出分组进行封装，最后通过物理线路端发送出去。  

### 四、网络层的拥塞控制  
1、网络拥塞  
一般发送网络拥塞有以下4种原因：
- 缓冲区容量有限
- 传输线路带宽有限
- 网络节点的处理能力有限
- 网络中某些部分发生了故障  

2、流量感知  
网络经常被抽象为一张带权的无向图，网络设备是节点，设备间的链路是边，传输所需的消耗就是权值。  
计算路由路径的时候通常是按照哪条路径的消耗小就走哪条路，但是这样的话会带来一个问题，就是如果都这样计算那么所有流量就会走同一路径导致流量过大产生拥塞。但是一般边的权值都会动态调整，当边上的流量增大以后，经过调整它的权值变大然后流量又找别的权值小的边走，这样往复就会导致整个网络出现振荡。  
解决这个问题的办法主要有两种：一是多路径路由，即两个区域间流量的传输分散到两条不同的链路上，从而使得其中任意链路上的负载都不会太大。二是将负载过大的链路上的流量，缓缓地转移到另一条链路上，而不是一次性将全部的流量转移至另一条链路上。  

3、准入控制  
准入控制是一种广泛用于虚电路网络的拥塞预防技术。准入控制的基本思想是对新建的虚电路审核，如果新建立的虚电路会导致网络变得拥塞，那么就拒绝建立该新电路。  

4、流量调节  
抑制分组：通知拥塞的上游路由器的最直接方式就是直接告知发送发。  
背压：因为如果在发送源结点和拥塞的结点之间有多跳路由的话，那么可能不能立即将拥塞信息告诉源结点，那么还是会有大量的分组传输过来。当拥塞结点想上游的第一跳路由传输拥塞信息的时候，第一跳路由首先控制向拥塞结点发送数据的速率，以减轻其拥塞情况，然后通过这样一级一级通告上去以后，最后到源结点以后，源的发送速率降下来以后拥塞就可以减缓。  

5、负载脱落  
负载脱落其实就是发送拥塞以后将来不及处理的分组直接丢弃，但是到底丢弃哪个分组才是关键问题。通常传输文件的话那就丢弃较新的分组，而流视频就丢弃较老的分组，这都是根据上层的应用性质来决定的。  

### 五、Internet网络层  
#### IPv4协议  
1、IPv4数据报格式：
![image](https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1532752901742&di=558b915d816a4e74e2a302de8f76b9df&imgtype=0&src=http%3A%2F%2Fpic002.cnblogs.com%2Fimages%2F2011%2F274044%2F2011062016440233.jpg)
- 版本号：用来区别IP协议的版本号，确认用什么协议解析该数据报。  
- 首部长度：给出IP数据报首部长度，以4字节为单位。
- 服务类型：用于区分不同类型的IP数据报，以提供更加合适的服务。  
- 数据报长度：数据报的总长度（报头加数据），以字节为单位。
- 标识：用于标识一个IP数据报，但这个标识并不是唯一的，想要确认唯一的IP数据报还要结合源和目的IP地址和协议等字段共同确定。
- 标志：占3位最高位保留，DF位是禁止分片标志DF=0允许分片，MF是更多分片标志MF=0表明该IP数据报未被分片过或者是分片的最后一块。
- 片偏移字段占13位：表示一个IP数据报分片封装与原IP数据报数据的相对偏移量，即封装的数据分片从原整个数据报的哪个字节开始，以8字节作为单位。
- 生存时间（TTL）：表示IP数据报可以在网络中通过的路由器数。如果TTL=0则直接丢弃该数据报，并向源主机发送一个ICMP报文。  
- 上层协议：指示了上层用了什么协议比如说TCP协议这里就填写6，UDP协议这里就写17。
- 首部校验和：该校验和和TCP报文中的校验和计算方式相同。
- 源IP地址：32位源IP地址
- 目的IP地址：32位目的IP地址
- 选项：范围在1~40字节，取决于选项内容，一般不用。
- 数据字段：上层传递过来的数据或者是ICMP报文。

2、IP数据报分片  
IP数据报从源到目的地要经过多个链路，但是链路不都是相同的，有些链路能承载的最大长度不尽相同，所以一个链路层协议帧能承受的最大数据量被称为该链路的最大传输单元（MTU）。这就是为什么IP数据报最大长度可以达到65535个字节，而实际的长度很少超过1500字节。
接下来就具体说下IP数据报到底是如何分片的：  
首先分片的话其中版本号，标识，源IP地址、目的IP地址等一些内容全部继承于原IP数据报中的内容，接收方的IP协议根据标识来判断是否为同一数据报的不同分片，然后根据标志位MF来判断是否为最后一位，除了最后一个分片外其余的MF=1。
假设要发送的数据报长度为L，而链路的MTU为M,并且L>M，DF=0,则将该IP数据报分片并且分片一定要是8字节的整数倍这就是为什么片偏移是13位而数据报长度有16位的原因。  
最大可分片长度为：d = ( M-20 / 8 ) * 8 其中括号中的结果向下取整  
需要的总分片数：n = (L - 20) / d 其中括号中的结果向上取整  
每个IP分片的片偏移取值：Fi = d/8 * （i-1）；1 <= i <= n  
每个IP分片的总长度字段为：除最后一个字段外其余全为d+20最后一个为L - d * (n - 1)  

#### IPv4的编址   
IP地址是由32bit构成的，一般IP地址有3中表示方法：十进制、二进制、十六进制。  
1、分类地址  
![image](https://imgsa.baidu.com/exp/w=480/sign=8f1fdbd9933df8dca63d8e99fd1072bf/43a7d933c895d143529b310d7ff082025aaf072b.jpg)  
A、B、C三类地址可以分配给主机和路由器使用，D类地址作为组播地址，E类地址保留。  

2、特殊地址  
本地主机地址：0.0.0.0/32   
有限广播地址：255.255.255.255/32 （广播范围只限于子网范围内）   
回送地址：127.0.0.0/8 （一般测试用）   
还有一些私有的IP地址  
A类：10.0.0.0~10.255.255.255  
B类：172.16.0.0~172.31.255.255  
C类：192.168.0.0~192.168.255.255  

3、无类地址  
无类地址就是摒弃了上面的分类规则，IP地址就是任意32位数字，其网络地址形式为a.b.c.d/x，x是网络前缀的长度，这种地址形式称为CIDR（Classes Inter-Domain Routing，无类域间路由）。  

4、子网划分  
为了缓解地址空间的不足，提高IP地址空间的利用率，另外两种策略就是子网化与超网化。子网化就是将一个较大的地址空间分割成较小的子网然后分配给各个组织使用，比如说A类的地址可以划分1024个子网然后每个子网拥有16384个IP地址。超网化就是上面子网化的逆过程，比如说有4个连续的C类地址那么就可以将这4个地址合并成一个前缀为22的超网，合并完后一共有1024个IP地址。  
接下来说下子网掩码，子网掩码就是根据子网IP地址来的，子网掩码也是32位，其中的位是根据子网地址的前缀长度来确定的，如果前缀是24位那么子网掩码前24个位就为1其余全为0，比如213.111.0.0/24其子网掩码就是255.255.255.0，或者你知道子网掩码和IP地址可以将这两个值进行位与运算，得出的结果就是其子网地址。例如IP地址为192.168.1.45，子网掩码为255.255.255.128，那么其子网地址就是192.168.1.0/25；还有一个小技巧就是如果用子网掩码的反码与该地址做位或运算的话得出的结果就是该子网直接广播地址，例子中算出的广播地址就是192.168.1.127。 

5、路由聚合  
子网划分后，会利用路由器等等三层网络互连设备互连这些子网，通过路由器实现子网间IP数据报的转发。路由器将路由信息存到转发表中，当收到IP数据报时就查询转发表，根据转发表来转发。
路由器将收到的IP数据报中的目的IP地址与转发表中的地址，逐个按位与，如果得出的结果匹配的话那么就将其发送出去，如果匹配完发现不止一个地址匹配的话那就选择前缀较长的地址发送，前缀较长的话说明地址比较具体，如果没有匹配成功的话那么就通过默认路由表项的路径转发IP数据报。  
路由聚合就是将有些路由表中可以合并的子网合并到一起然后转发的时候先转发到大的子网上然后在细分到小的子网上去。

#### 动态主机配置协议（DHCP）  
当一个组织拿到一到一个网络地址块以后，需要对新来的主机进行网络地址的配置，这个任务可以由网络管理人员来进行，也可以让计算机自动获取。  
其实DHCP就是一个动态IP地址分配的协议，DHCP是在应用层实现的，传输层使用UDP。DHCP服务的提供者需要开启DHCP服务（67号端口），并且要指定可分配的IP范围，而使用者也要开启DHCP服务（68号端口）。  
DHCP工作过程如下图所示  
![image](http://s8.51cto.com/wyfs02/M01/2C/E7/wKioL1ORGIGTer2IAAGy0LZK4tQ327.jpg-wh_651x-s_3149160119.jpg)  
1、客户端DHCP发现：新到的主机首要的任务就是发送DHCP发现报文，主机使用UDP向67号端口发送DHCP报文，UDP将报文交给网络层进行封装其目的地IP地址是不知道的，所以目的地就填写本地的广播地址255.255.255.255，而源IP地址填写0.0.0.0。  
2、DHCP服务器：当某台本地的DHCP服务器（或路由器）接收都了来自于67号端口上的DHCP发现报文，会发送一个DHCP提供报文，来响应主机。向上面一样DHCP服务器也不知道请求端的IP只能将其发送到广播地址上去，DHCP提供报文中包含了DHCP服务器为新加入网络的主机分配的IP地址、用于标识一次DHCP过程的标识符、子网掩码、默认网关、本地域名服务器IP地址以及IP租赁信息等。  
3、DHCP请求：当网络中有多个DHCP服务器（或路由），那么客户端的发现报文就会收到多个响应而客户端需要在其中挑选一个来进行响应，所以客户端会发送一个请求报文到广播地址上以请求一个DHCP服务器来进行服务。  
4、DHCP确认：被选定的DHCP服务器以DHCP确认报文来对DHCP请求报文进行响应。当客户收到其响应报文后就开始使用其提供的一系列的信息。  


#### 网络地址转换（NAT）  
由于IPv4的地址已经消耗殆尽，很多连接到Internet上的主机没办法获得合法的共IP地址，只能使用私有地址。但是私有地址在公共网上的无效的，这时就产生了一个解决方案就是进行地址转换（NAT），将私有地址转换成公共的IP地址。  
其原理是当内部网络要向外发送数据的时候，先将数据传到NAT服务器上，到了NAT服务器上以后将其源IP地址替换成NAT服务器的地址，同时也替换源端口号，并且将其替换关系添加到NAT转换表中，这样发出去就合法了。对于外部服务器的返回的包，根据其目的地IP和目的的端口号检索NAT转换表，并利用检索到的内部私有IP地址与对应的端口号进行替换，然后转发到其内部网络。 

NAT穿透技术  
根据NAT的工作原理来看，貌似只能从源主机发送数据出去之后才能接收到外来的数据，而外来的数据不能直接与本地主机通讯，这时候就出现了NAT穿透技术。  
NAT穿透技术说白了就是将转换信息添加到NAT转换表中，这样外面的主机就可以与内网的主机联系了。通常由2种配置方法，一是静态配置，就是人为的将转换信息添加到转换表中。二是动态配置这种配置方法需要本地主机和NAT服务器都要支持UPnP协议，然后内网的主机可以基于UPnP协议，请求NAT配置一项内网到公网的映射。  

#### ICMP  
主机或路由器在处理或转发IP数据报的过程中，由于各种原因可能导致异常发生，此时就会向源主机发送一个ICMP报文，来通知在传输中发送的错误。  
ICMP报文格式：  
![image](https://gss2.bdstatic.com/-fo3dSag_xI4khGkpoWK1HF6hhy/baike/c0%3Dbaike72%2C5%2C5%2C72%2C24/sign=ac6d65b312dfa9ece9235e4503b99c66/ae51f3deb48f8c54ca50c28039292df5e1fe7f99.jpg)  
一般ICMP分为两大类一类是报告报文和查询报文，根据不同的类型和代码来确定到底是什么报文。接下来看下报文的类型。  
![image](https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1532856630448&di=c0053113266e426b7e9ecc8598315c72&imgtype=jpg&src=http%3A%2F%2Fimg2.imgtn.bdimg.com%2Fit%2Fu%3D1876146157%2C2898205490%26fm%3D214%26gp%3D0.jpg)  
ICMP还有许多用处，比如说Ping程序，Traceroute程序等，都是利用了ICMP报文来实现的。  

#### IPv6
IPv6通过拓展IP地址的位数来解决IPv4地址资源枯竭的问题，其将32位地址拓展成128位的地址空间，这样的话那么地址空间就基本无穷大了。  
数据报格式  
![image](http://blog.chinaunix.net/attachment/201205/13/9112803_1336895498zSUG.png)  
版本号：与IPv4版本号一样给出协议版本号。  
流量类型：与IPv4中TOS字段具有相同的含义。
流标签：用于标识一系列数据报的流。  
有效载荷长度：用于说明IPv6数据报中数据的字节数量。  
下一个报头：用于标识数据报中承载的数据应该交给上层哪一个协议比如说TCP、UDP等；或者指向别的选项首部。  
跳限制（TTL）：跟IPv4中的跳限制一样就是可以经过的路由器数。  
IPv6的数据报首部长度固定为40字节，与IPv4相比删除了一些字段，比如说分片功能在IPv6中就不存在了，当中间路由的MTU太小数据报通不过的话就直接丢弃该数据报，然后向源主机发送一个ICMP报文通知其数据报太大不能通过。IPv6也有一些额外的选项这里就不具体讨论了，如果有别的额外选项就由首部中下一个报文来指向选项首部。  

IPv6的地址编制方式：IPv6的地址长度为128位通常用8组冒号分隔的十六进制数地址形式来标识，因为其长度太长所以有时候会由连续的0000，当碰到这样的地址时可以采用：：两个冒号将其省略，但是一个地址里面只能用一次双冒号来省略。 

IPv6地址分为3类包括单播地址、组播地址和任播地址。  
单播地址：唯一标识网络中的一个主机和路由器接口，可以作为IPv6数据报的源和目的地址。  
组播地址：标识网络中的一组主机，只能用作IPv6数据报的目的地，向一个组播地址发送IP数据报，该组播地址标识的多播组每个成员都会收到一该IP数据报的一个副本。  
任播地址：也是标识网络中的一组主机，也只能用作IPv6数据报的目的地址，但当向一个任播地址发送IP数据报时，只有该任播地址标识的任播组的某成员收到该IP数据报。  

IPv4到IPv6的迁移，由于IPv6普及还不是很到位，所以现在的网络中IPv4和IPv6都是可以使用的，这样就要求结点要支持双协议栈，结点根据DNS来感知通讯对方是是使用什么协议的继而使用什么协议跟对方通讯，当对方使用IPv4的话那么DNS就返回IPv4地址，同理返回IPv6的地址。还有一个问题就是在传输的过程中如果碰到两段协议不同的链路如何处理，一般是收到IPv6协议以后，将IPv6数据报整个当数据封装到IPv4数据报中然后传输到下一个结点以后在讲其拆包继续传输，这种技术称为隧道技术。    
### 六、路由算法与路由协议  
在讨论路由算法的之前首先提一个默认网关的概念，默认网关就是主机与路由器相连的那个相应的路由器接口上的IP地址。
然后就要讨论这章的核心内容-转发，这里所要解决的问题是如何将一个报文以最少的代价从源主机的路由器送到目的地，即选择一条最优的路径。  

一般在讨论如何选择最优路径的时候都是将整个网络抽象成一个图的结构，其中路由器就是图中的结点，而边就是其中的链路，边上的权值就是路由的代价，一般权值越小就代表其路由代价比较小。  

路由算法一般分为全局式路由选择算法，还有分布式路由选择算法。  
全局式路由算法：全局式路由算法是基于全局的网络拓扑结构，根据其拓扑结构来计算最佳的路径，要求每一跳的路由都需要知道全部的拓扑结构，典型算法是链路状态路由选择算法（LS算法）。  
分布式路由选择：分布式路由算法不需要知道完整的网络拓扑结构，只需要知道与其相连的结点之间的”费用“信息，以及邻居到达目的结点的“费用”，然后经过不断的迭代计算，最终得到可以经过哪个结点可以到达目的结点的最短路径，典型算法是距离向量路由选择算法（DV算法）。  

#### 链路状态路由算法  （LS算法）  
其实这里的算法比较简单，知道了全局的网络拓扑结构以后，根据Dijkstra算法求最短路径就行了。  
具体的算法这里就不详述了，详见《算法》中如何计算最短路径。   

#### 距离向量路由选择算法（DV算法）  
这里关于距离向量算法也不过多的描述，其原理是根据Bellman——Ford方程来计算其最优路径。
Bellman——Ford方程：Dx(Y) = min{ c(x,v) + Dv(Y) }
c(x,v)是当前结点到下一跳结点的距离
Dv(Y)是下一个结点到目的地之间的距离
在本地保存了到下一跳的距离和下一跳到目的地的距离，在这些距离中选择最小的就是最优路径。

#### 层次化路由选择  
其实不论是LS算法还是DV算法，在大规模的网络中都非常消耗资源，因此上述的两种算法在实际应用时，需要将其限制在一定规模的网络中使用。所以将一个庞大的网络划分成多个小的网络进行管理，这样的小网络就称为自治系统（AS），每个自治系统内部使用同一种路由算法。其实每个自治系统内需要有一个与外部联系的路由器，称为网关路由，负责跨自治系统的传输。  

接下来具体说下数据到底如何在自治系统间传输的，如果一个自治系统内只有一个对外的网关路由器，如果数据报要发出去那肯定是将数据发送至网关路由器上然后在发送出去。如果一个自治系统内有多个网关路由器的话，那么这些网关路由器就要通告其自治系统内部的主机，告知这些网关路由器分别可以到达的地方，将信息存储在各个结点的转发表中供查询。  



#### Internet路由选择协议  
Internet路由是层次化路由选择，Internet的自治系统内部的路由选择称为内部网关协议（IGP），而自治系统间的路由选择协议称为外部网关协议（EGP）。典型的内部网关协议有RIP和OSPF，而典型的外部网关协议有BGP
##### RIP  
RIP是最早的内部网关协议之一，目前仍被广泛使用。RIP是基于DV算法，其度量路径长度的时候是基于通过路由器的数量的，即假设每条链路的费用都是相同的，所以这里的最短路径就是从源到目的地之间经过最少路由器的哪条路径。RIP仅对路由器跳数在15跳以内的AS有效，所以在RIP协议中最大跳数为15跳，如果路径的费用为16的话那么就说明距离无穷大即不可到达。RIP通过响应报文来交换距离向量，交换频率为30s一次，RIP响应报文也称为RIP通告。  
RIP的实现也是在应用层实现的，传输层用UDP协议。  

##### OSPF   
OSPF也是一种广泛应用的内部路由协议，它与RIP之间的区别就是，它可以应用于较大规模的AS中。OSPF基于LS算法，OSPF对于边的权值没有限制，可以是跳数、也可以是链路的带宽等，OSPF只基于Dijkstra算法求解最短路径。在OSPF中的每台路由器都需要向所有路由器广播链路状态分组，当链路状态一发生变化的话就立即通知其他路由器以保证最佳状态，即使链路状态一直没有发生变化的话那么也要周期性的广播一下链路状态以保证其算法的健壮性。  
OSPF的报文不经过传输层直接封装到IP数据报中。
OSPF的优点：  
- 安全：所有OSPF报文都是经过认证的，这样可以预防恶意将不正确的路由信息注入路由器转发表中。  
- 支持多条相同费用的路径，这样的话可以均衡网络负载，以免流量都从一条路径上走。  
- 支持区别化费用度量。OSPF支持对于同一条链路，根据IP数据报中TOS不同，设置不同的费用度量，从而可以实现不同类型的网络流量的分流。  
- 分层路由。OSPF支持在大规模的AS中进一步进行分层路由。  

##### BGP
BGP协议实现了在不同的自治系统间实现数据传输。  
BGP实现了以下的功能：  
从相邻AS获取某子网的可达性。    
向本AS内部的所有路由器传播跨AS的某子网可达性信息。  
基于某子网可达性信息和AS路由策略，决定到达该子网的最佳路由。  

BGP也是由应用进程实现的，传输层适用TCP。如果一个路由器需要与另一个路由器通过BGP交换跨自治系统的网络可达信息，就通过使用179号端口建立的半永久TCP连接，交换BGP报文来实现。BGP对于内部通讯的报文称为内部BGP会话简称iBGP，对于外部的会话称为eBGP。  

BGP的报文种类：  
- OPEN（打开）报文，用于与BGP对等方建立BGP会话。  
- UPDATE（更新）报文，用于通告某一路由可达性信息，或者撤销已有路由。  
- KEEPALIVE（保活）报文，用于对打开报文确认，或周期性地证实会话有效性。  
- NOTIFICANTION（通知）报文，用于通告差错。  

一个本地网关路由会将其可达的地址进行路由聚合，然后在通告给其它的AS网关路由，本地AS接收到其他网关路由的信息后将这些信息通告给内部的路由器，以便内部路由器查询。  

在使用BGP的网络中，每个AS都有一个全局唯一的自治系统号ASN，作为该AS的标识。当一台路由器通过BGP会话向另一台路由器通告一个前缀时，前缀中包含一些重要的属性，比较重要的属性是AS-PATH和NEXT-HOP。  
AS-PATH：即AS路径，是到达前缀（就是到达发出这条路由的哪个网关）需要经过的AS路径，该属性包含了一条路由已通知过的AS。假设有AS2向AS1发送一个路由首先将AS2添加到AS-PATH中，然后AS1又将此内容通告给AS，那么就要将AS1也添加到这条路由信息中去，就变成了（AS1,AS2）。  
NEXT-HOP：NEXT-HOP指的是发出通告的那个网关路由器的接口。  

对于一条路由信息到达网关路由器后，需要经过一定的策略来决定是否接收还是丢弃该路由。下面是一些策略。  
1、本地偏好值属性。这个属性由AS网络管理员来决定，具有最高偏好的路由被选择。  
2、若多条路由具有相同的本地偏好，那么具有最短AS-PATH的路由被选择。  
3、若多条路由具有相同的本地偏好以及相同的AS-PATH，那么具有最近的NEXT-HOP的路由将被选择。








